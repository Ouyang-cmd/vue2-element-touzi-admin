{"remainingRequest":"C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\src\\store\\modules\\permission.js","dependencies":[{"path":"C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\src\\store\\modules\\permission.js","mtime":1677382302056},{"path":"C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\babel.config.js","mtime":1677382256176},{"path":"C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport { asyncRouterMap, constantRouterMap } from '@/router';\nimport { topRouterMap } from \"@/router/topRouter\";\nimport * as mutils from '@/utils/mUtils';\n\n// 循环追加顶栏菜单\nfunction addTopRouter() {\n  asyncRouterMap.forEach(function (item) {\n    if (item.children && item.children.length >= 1) {\n      item.children.forEach(function (sitem) {\n        topRouterMap.forEach(function (citem) {\n          if (sitem.name === citem.parentName) {\n            var newChildren = item.children.concat(citem.topmenulist); // arr\n            item.children = newChildren;\n          }\n        });\n      });\n    }\n  });\n  return asyncRouterMap;\n}\n\n// 获取到当前路由对应顶部子菜单\nfunction filterTopRouters(data) {\n  var topRouters = topRouterMap.find(function (item) {\n    return item.parentName === data.name;\n  });\n  if (!mutils.isEmpty(topRouters)) {\n    return topRouters.topmenulist;\n  }\n}\n\n/**\r\n * 通过meta.role判断是否与当前用户权限匹配\r\n * @param roles\r\n * @param route\r\n */\nfunction hasPermission(roles, route) {\n  // roles为权限身份数组\n  if (route.meta && route.meta.roles) {\n    return roles.some(function (role) {\n      return route.meta.roles.indexOf(role) >= 0;\n    });\n  } else {\n    return true;\n  }\n}\n\n/**\r\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\r\n * @param asyncRouterMap\r\n * @param roles\r\n */\nfunction filterAsyncRouter(asyncRouterMap, roles) {\n  // 返回满足条件的子路由对象\n  var accessedRouters = asyncRouterMap.filter(function (route) {\n    if (hasPermission(roles, route)) {\n      if (route.children && route.children.length) {\n        // route.children重新过滤赋值;\n        route.children = filterAsyncRouter(route.children, roles);\n      }\n      return true; // 返回该权限路由对象;\n    }\n\n    return false;\n  });\n  return accessedRouters;\n}\nvar permission = {\n  state: {\n    routers: constantRouterMap,\n    addRouters: [],\n    topRouters: [],\n    topTitle: '',\n    menuIndex: 0\n  },\n  getters: {\n    permission_routers: function permission_routers(state) {\n      return state.routers;\n    },\n    // 所有路由\n    addRouters: function addRouters(state) {\n      return state.addRouters;\n    },\n    // 权限过滤路由\n    topRouters: function topRouters(state) {\n      return state.topRouters;\n    },\n    // 顶部三级路由\n    topTitle: function topTitle(state) {\n      return state.topTitle;\n    },\n    // 顶部的title\n    menuIndex: function menuIndex(state) {\n      return state.menuIndex;\n    } // 顶部菜单的index\n  },\n\n  mutations: {\n    SET_ROUTERS: function SET_ROUTERS(state, routers) {\n      state.addRouters = routers; // 权限路由\n      state.routers = constantRouterMap.concat(routers); // 总路由\n    },\n\n    CLICK_INNER_LEFT_MENU: function CLICK_INNER_LEFT_MENU(state, data) {\n      // titleList:arr\n      state.topRouters = data.titleList;\n    },\n    CLICK_TOP_MENU: function CLICK_TOP_MENU(state, data) {\n      state.topTitle = data.title;\n      state.menuIndex = data.menuIndex;\n    }\n  },\n  actions: {\n    // 根据角色，重新设置权限路由;并保存到vuex中,SET_ROUTERS;\n    GenerateRoutes: function GenerateRoutes(_ref, data) {\n      var commit = _ref.commit;\n      return new Promise(function (resolve) {\n        var roles = data.roles;\n        var accessedRouters = '';\n        if (roles.indexOf('admin') >= 0) {\n          // 如果是管理员，直接将权限路由赋值给新路由;\n          accessedRouters = asyncRouterMap;\n        } else {\n          // 非管理员用户,如roles:['editor','developer']，则需要过滤权限路由数据\n          accessedRouters = filterAsyncRouter(asyncRouterMap, roles);\n        }\n        commit('SET_ROUTERS', accessedRouters);\n        resolve();\n      });\n    },\n    ClickLeftInnerMenu: function ClickLeftInnerMenu(_ref2, data) {\n      var commit = _ref2.commit;\n      commit('CLICK_INNER_LEFT_MENU', data);\n    },\n    ClickTopMenu: function ClickTopMenu(_ref3, data) {\n      var commit = _ref3.commit;\n      commit('CLICK_TOP_MENU', data);\n    }\n  }\n};\nexport default permission;",{"version":3,"names":["asyncRouterMap","constantRouterMap","topRouterMap","mutils","addTopRouter","forEach","item","children","length","sitem","citem","name","parentName","newChildren","concat","topmenulist","filterTopRouters","data","topRouters","find","isEmpty","hasPermission","roles","route","meta","some","role","indexOf","filterAsyncRouter","accessedRouters","filter","permission","state","routers","addRouters","topTitle","menuIndex","getters","permission_routers","mutations","SET_ROUTERS","CLICK_INNER_LEFT_MENU","titleList","CLICK_TOP_MENU","title","actions","GenerateRoutes","_ref","commit","Promise","resolve","ClickLeftInnerMenu","_ref2","ClickTopMenu","_ref3"],"sources":["C:/Users/ou943/Desktop/pro-vue/vue2-element-touzi-admin/src/store/modules/permission.js"],"sourcesContent":["import { asyncRouterMap, constantRouterMap } from '@/router'\r\nimport { topRouterMap } from \"@/router/topRouter\";\r\nimport * as mutils from '@/utils/mUtils'\r\n\r\n\r\n\r\n// 循环追加顶栏菜单\r\nfunction addTopRouter(){\r\n  asyncRouterMap.forEach( (item) => {\r\n    if(item.children && item.children.length >= 1){\r\n      item.children.forEach((sitem) => {\r\n       topRouterMap.forEach((citem) => {\r\n          if(sitem.name === citem.parentName){\r\n              let newChildren = item.children.concat(citem.topmenulist); // arr\r\n              item.children = newChildren;\r\n          }\r\n       })\r\n      })\r\n    }\r\n  })\r\n  return asyncRouterMap;\r\n}\r\n\r\n // 获取到当前路由对应顶部子菜单\r\n function filterTopRouters(data){\r\n    let topRouters = topRouterMap.find((item)=>{\r\n       return item.parentName === data.name\r\n    })\r\n    if(!mutils.isEmpty(topRouters)){\r\n       return topRouters.topmenulist;\r\n    }\r\n}\r\n\r\n/**\r\n * 通过meta.role判断是否与当前用户权限匹配\r\n * @param roles\r\n * @param route\r\n */\r\nfunction hasPermission(roles, route) {\r\n  // roles为权限身份数组\r\n  if (route.meta && route.meta.roles) {\r\n    return roles.some(role => route.meta.roles.indexOf(role) >= 0)\r\n  } else {\r\n    return true\r\n  }\r\n}\r\n\r\n/**\r\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\r\n * @param asyncRouterMap\r\n * @param roles\r\n */\r\nfunction filterAsyncRouter(asyncRouterMap, roles) {\r\n  // 返回满足条件的子路由对象\r\n  const accessedRouters = asyncRouterMap.filter(route => {\r\n    if (hasPermission(roles, route)) {\r\n      if (route.children && route.children.length) {\r\n        // route.children重新过滤赋值;\r\n        route.children = filterAsyncRouter(route.children, roles)\r\n      }\r\n      return true // 返回该权限路由对象;\r\n    }\r\n    return false\r\n  })\r\n  return accessedRouters\r\n}\r\n\r\n\r\nconst permission = {\r\n  state: {\r\n    routers: constantRouterMap,\r\n    addRouters: [],\r\n    topRouters:[],\r\n    topTitle:'',\r\n    menuIndex:0\r\n  },\r\n  getters:{\r\n    permission_routers: state => state.routers, // 所有路由\r\n    addRouters: state => state.addRouters,  // 权限过滤路由\r\n    topRouters: state => state.topRouters,  // 顶部三级路由\r\n    topTitle:state => state.topTitle, // 顶部的title\r\n    menuIndex:state => state.menuIndex, // 顶部菜单的index\r\n  },\r\n  mutations: {\r\n    SET_ROUTERS: (state, routers) => {\r\n      state.addRouters = routers // 权限路由\r\n      state.routers = constantRouterMap.concat(routers) // 总路由\r\n    },\r\n    CLICK_INNER_LEFT_MENU:(state,data) => { // titleList:arr\r\n        state.topRouters = data.titleList;\r\n    },\r\n    CLICK_TOP_MENU:(state,data) => {\r\n      state.topTitle = data.title\r\n      state.menuIndex = data.menuIndex\r\n\r\n    },\r\n  },\r\n  actions: {\r\n    // 根据角色，重新设置权限路由;并保存到vuex中,SET_ROUTERS;\r\n    GenerateRoutes({ commit }, data) {\r\n      return new Promise(resolve => {\r\n        let roles = data.roles;\r\n        let accessedRouters = '';\r\n        if (roles.indexOf('admin') >= 0) {\r\n          // 如果是管理员，直接将权限路由赋值给新路由;\r\n          accessedRouters = asyncRouterMap\r\n        } else {\r\n          // 非管理员用户,如roles:['editor','developer']，则需要过滤权限路由数据\r\n          accessedRouters = filterAsyncRouter(asyncRouterMap, roles)\r\n        }\r\n        commit('SET_ROUTERS', accessedRouters)\r\n        resolve()\r\n      })\r\n    },\r\n    ClickLeftInnerMenu({ commit },data) {\r\n      commit('CLICK_INNER_LEFT_MENU',data)\r\n    },\r\n    ClickTopMenu({ commit },data) {\r\n      commit('CLICK_TOP_MENU',data)\r\n    }\r\n  }\r\n}\r\n\r\nexport default permission\r\n"],"mappings":"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"}]}