{"remainingRequest":"C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\src\\permission.js","dependencies":[{"path":"C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\src\\permission.js","mtime":1677382302046},{"path":"C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\babel.config.js","mtime":1677382256176},{"path":"C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\ou943\\Desktop\\pro-vue\\vue2-element-touzi-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"C:/Users/ou943/Desktop/pro-vue/vue2-element-touzi-admin/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es6.function.name\";\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nimport router from \"./router\";\nimport store from \"./store\";\nimport NProgress from 'nprogress'; // Progress 进度条\nprocess.env.NODE_ENV === \"development\" && import('nprogress/nprogress.css');\nimport { Message } from 'element-ui';\nimport { getToken } from '@/utils/auth'; // 验权(从cookie中获取)\nimport { getUserInfo } from \"@/api/user\";\nimport { setTitle } from '@/utils/mUtils'; // 设置浏览器头部标题\n\nfunction hasPermission(roles, permissionRoles) {\n  if (roles.indexOf('admin') >= 0) return true;\n  if (!permissionRoles) return true;\n  return roles.some(function (role) {\n    return permissionRoles.indexOf(role) >= 0;\n  });\n}\nvar whiteList = ['/login']; // 不重定向白名单\n\nrouter.beforeEach(function (to, from, next) {\n  NProgress.start();\n  // 设置浏览器头部标题\n  var browserHeaderTitle = to.meta.title;\n  store.commit('SET_BROWSERHEADERTITLE', {\n    browserHeaderTitle: browserHeaderTitle\n  });\n  // 点击登录时，拿到了token并存入了cookie,保证页面刷新时,始终可以拿到token\n  if (getToken('Token')) {\n    if (to.path === '/login') {\n      next({\n        path: '/'\n      });\n      NProgress.done();\n    } else {\n      // 用户登录成功之后，每次点击路由都进行了角色的判断;\n      if (store.getters.roles.length === 0) {\n        var token = getToken('Token');\n        getUserInfo({\n          \"token\": token\n        }).then().then(function (res) {\n          // 根据token拉取用户信息\n          var userList = res.data.userList;\n          store.commit(\"SET_ROLES\", userList.roles);\n          store.commit(\"SET_NAME\", userList.name);\n          store.commit(\"SET_AVATAR\", userList.avatar);\n          store.dispatch('GenerateRoutes', {\n            \"roles\": userList.roles\n          }).then(function () {\n            // 根据roles权限生成可访问的路由表\n            router.addRoutes(store.getters.addRouters); // 动态添加可访问权限路由表\n            next(_objectSpread(_objectSpread({}, to), {}, {\n              replace: true\n            })); // hack方法 确保addRoutes已完成\n          });\n        }).catch(function (err) {\n          store.dispatch('LogOut').then(function () {\n            Message.error(err || 'Verification failed, please login again');\n            next({\n              path: '/'\n            });\n          });\n        });\n      } else {\n        // 没有动态改变权限的需求可直接next() 删除下方权限判断 ↓\n        if (hasPermission(store.getters.roles, to.meta.roles)) {\n          next(); //\n        } else {\n          next({\n            path: '/401',\n            replace: true,\n            query: {\n              noGoBack: true\n            }\n          });\n        }\n      }\n    }\n  } else {\n    if (whiteList.indexOf(to.path) !== -1) {\n      // 点击退出时,会定位到这里\n      next();\n    } else {\n      next('/login');\n      NProgress.done();\n    }\n  }\n});\nrouter.afterEach(function () {\n  NProgress.done(); // 结束Progress\n  setTimeout(function () {\n    var browserHeaderTitle = store.getters.browserHeaderTitle;\n    setTitle(browserHeaderTitle);\n  }, 0);\n});\n\n/**\r\n  本系统权限逻辑分析：\r\n  1、路由对象区分权限路由对象和非权限路由对象；初始化时，将非权限路由对象赋值给Router;同时设置权限路由中的meta对象，如:meta:{roles:['admin','editor']}\r\n     表示该roles所拥有的路由权限;\r\n  2、通过用户登录成功之后返回的roles值，进行路由的匹配并生成新的路由对象;\r\n  3、用户成功登录并跳转到首页时，根据刚刚生成的路由对象，渲染左侧的菜单;即，不同的用户看到的菜单是不一样的;\r\n  \r\n  用户点击登录和退出之后的业务逻辑分析：\r\n  1、用户点击登录按钮，通过路由导航钩子router.beforeEach()函数确定下一步的跳转逻辑,如下：\r\n   1.1、用户已经登录成功过，并从cookie中拿到了token值;\r\n     1.1.1、用户访问登录页面,直接定位到登录页面;\r\n     1.1.1、用户访问非登录页面,需要根据用户是否有roles信息，进行不同的业务逻辑,如下：\r\n        (1)、初始情况下,用户roles信息为空;\r\n            1.通过getUserInfo()函数,根据token拉取用户信息;并通过store将该用户roles,name,avatar信息存储于vuex;\r\n            2.通过store.dispatch('GenerateRoutes', { roles })去重新过滤和生成路由,通过router.addRoutes()合并路由表;   \r\n            3.如果在获取用户信息接口时出现错误，则调取store.dispatch('LogOut')接口,返回到login页面;\r\n          \r\n        (2)、用户已经拥有roles信息；\r\n            1.点击页面路由，通过roles权限判断 hasPermission()。如果用户有该路由权限，直接跳转对应的页面;如果没有权限，则跳转至401提示页面;\r\n  \r\n  2.用户点击退出,token已被清空\r\n    1.如果设置了白名单用户，则直接跳转到相应的页面;\r\n    2.反之,则跳转至登录页面;\r\n */",{"version":3,"names":["router","store","NProgress","process","env","NODE_ENV","Message","getToken","getUserInfo","setTitle","hasPermission","roles","permissionRoles","indexOf","some","role","whiteList","beforeEach","to","from","next","start","browserHeaderTitle","meta","title","commit","path","done","getters","length","token","then","res","userList","data","name","avatar","dispatch","addRoutes","addRouters","_objectSpread","replace","catch","err","error","query","noGoBack","afterEach","setTimeout"],"sources":["C:/Users/ou943/Desktop/pro-vue/vue2-element-touzi-admin/src/permission.js"],"sourcesContent":["import router from './router'\r\nimport store from './store'\r\nimport NProgress from 'nprogress' // Progress 进度条\r\nprocess.env.NODE_ENV === \"development\" && import('nprogress/nprogress.css')\r\nimport { Message } from 'element-ui'\r\nimport { getToken } from '@/utils/auth' // 验权(从cookie中获取)\r\nimport { getUserInfo } from \"@/api/user\";\r\nimport {\r\n  setTitle\r\n} from '@/utils/mUtils' // 设置浏览器头部标题\r\n\r\nfunction hasPermission(roles, permissionRoles) {\r\n  if (roles.indexOf('admin') >= 0) return true \r\n  if (!permissionRoles) return true\r\n  return roles.some(role => permissionRoles.indexOf(role) >= 0)\r\n}\r\nconst whiteList = ['/login'] // 不重定向白名单\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n  NProgress.start()\r\n   // 设置浏览器头部标题\r\n   const browserHeaderTitle = to.meta.title\r\n   store.commit('SET_BROWSERHEADERTITLE', {\r\n     browserHeaderTitle: browserHeaderTitle\r\n   })\r\n  // 点击登录时，拿到了token并存入了cookie,保证页面刷新时,始终可以拿到token\r\n  if (getToken('Token')) {\r\n    if(to.path === '/login') {\r\n      next({ path: '/' })  \r\n      NProgress.done() \r\n    } else {\r\n      // 用户登录成功之后，每次点击路由都进行了角色的判断;\r\n      if (store.getters.roles.length === 0) {\r\n        let token = getToken('Token');\r\n        getUserInfo({\"token\":token}).then().then(res => { // 根据token拉取用户信息\r\n          let userList = res.data.userList;\r\n          store.commit(\"SET_ROLES\",userList.roles);\r\n          store.commit(\"SET_NAME\",userList.name);\r\n          store.commit(\"SET_AVATAR\",userList.avatar);\r\n          store.dispatch('GenerateRoutes', { \"roles\":userList.roles }).then(() => { // 根据roles权限生成可访问的路由表\r\n            router.addRoutes(store.getters.addRouters) // 动态添加可访问权限路由表\r\n            next({ ...to, replace: true }) // hack方法 确保addRoutes已完成\r\n          })\r\n        }).catch((err) => {\r\n          store.dispatch('LogOut').then(() => {\r\n            Message.error(err || 'Verification failed, please login again')\r\n            next({ path: '/' })\r\n          })\r\n        })\r\n      } else {\r\n        // 没有动态改变权限的需求可直接next() 删除下方权限判断 ↓\r\n        if (hasPermission(store.getters.roles, to.meta.roles)) {\r\n          next()//\r\n        } else {\r\n          next({ path: '/401', replace: true, query: { noGoBack: true }})\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n      // 点击退出时,会定位到这里\r\n      next()\r\n    } else {\r\n      next('/login')\r\n      NProgress.done()\r\n    }\r\n  }\r\n})\r\n\r\nrouter.afterEach(() => {\r\n  NProgress.done() // 结束Progress\r\n  setTimeout(() => {\r\n    const browserHeaderTitle = store.getters.browserHeaderTitle\r\n    setTitle(browserHeaderTitle)\r\n  }, 0)\r\n})\r\n\r\n\r\n\r\n/**\r\n  本系统权限逻辑分析：\r\n  1、路由对象区分权限路由对象和非权限路由对象；初始化时，将非权限路由对象赋值给Router;同时设置权限路由中的meta对象，如:meta:{roles:['admin','editor']}\r\n     表示该roles所拥有的路由权限;\r\n  2、通过用户登录成功之后返回的roles值，进行路由的匹配并生成新的路由对象;\r\n  3、用户成功登录并跳转到首页时，根据刚刚生成的路由对象，渲染左侧的菜单;即，不同的用户看到的菜单是不一样的;\r\n  \r\n  用户点击登录和退出之后的业务逻辑分析：\r\n  1、用户点击登录按钮，通过路由导航钩子router.beforeEach()函数确定下一步的跳转逻辑,如下：\r\n   1.1、用户已经登录成功过，并从cookie中拿到了token值;\r\n     1.1.1、用户访问登录页面,直接定位到登录页面;\r\n     1.1.1、用户访问非登录页面,需要根据用户是否有roles信息，进行不同的业务逻辑,如下：\r\n        (1)、初始情况下,用户roles信息为空;\r\n            1.通过getUserInfo()函数,根据token拉取用户信息;并通过store将该用户roles,name,avatar信息存储于vuex;\r\n            2.通过store.dispatch('GenerateRoutes', { roles })去重新过滤和生成路由,通过router.addRoutes()合并路由表;   \r\n            3.如果在获取用户信息接口时出现错误，则调取store.dispatch('LogOut')接口,返回到login页面;\r\n          \r\n        (2)、用户已经拥有roles信息；\r\n            1.点击页面路由，通过roles权限判断 hasPermission()。如果用户有该路由权限，直接跳转对应的页面;如果没有权限，则跳转至401提示页面;\r\n  \r\n  2.用户点击退出,token已被清空\r\n    1.如果设置了白名单用户，则直接跳转到相应的页面;\r\n    2.反之,则跳转至登录页面;\r\n */"],"mappings":"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"}]}